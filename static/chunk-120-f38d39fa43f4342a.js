(self.webpackChunk=self.webpackChunk||[]).push([[120],{126:(e,t,r)=>{r.d(t,{A:()=>n});const n={files:"UkIEeLqU2Pl7TsFd",output:"_sD7o_wV7TBzPe_2","close-icon":"n7k4OaLTM847piQx"}},298:(e,t,r)=>{r.d(t,{Bc:()=>i,Hk:()=>l,Lg:()=>c,bw:()=>u,mF:()=>o});const n=/\+|\/|=/g,i=async e=>{const t=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),r=await new Response(t).blob();return await new Promise((e=>{const t=new FileReader;t.onerror=()=>{e({err:t.error??new Error("File reader error")})},t.onload=()=>{if("string"!=typeof t.result)return void e({err:new Error("File reader result is not a string")});const r=t.result.indexOf(",");if(r<0)return void e({err:new Error("File reader result malformed")});const i=t.result.replaceAll(n,(e=>{switch(e){case"+":return"-";case"/":return"_";default:return""}})).slice(r+1);e({value:i})},t.readAsDataURL(r)}))},s=/-|_/g,o=async e=>{const t=e.replaceAll(s,(e=>{switch(e){case"-":return"+";case"_":return"/";default:return""}})),r=await fetch(`data:application/octet-stream;base64,${t}`),n=r.body?.pipeThrough(new DecompressionStream("gzip"))??new Blob([""]).stream();try{return{value:await new Response(n).arrayBuffer()}}catch(e){return{err:new Error("Failed decoding data",{cause:e})}}},a=(e,t,r)=>{const n=new ArrayBuffer(Math.min(t,r));return new Uint8Array(n).set(new Uint8Array(e)),n},l=e=>{const t=e.reduce(((e,t)=>e+t.length),0),r=t+4*e.length,n=3*t+4*e.length;let i=new ArrayBuffer(r),s=0;const o=new TextEncoder;for(let t of e){let e=0;for(;t.length>0;){const r=s+e+4+3*t.length;r>i.byteLength&&(i=a(i,r,n));const l=new Uint8Array(i,s+e+4),{read:u,written:c}=o.encodeInto(t,l);e+=c,t=t.slice(u)}new DataView(i,s).setUint32(0,e,!1),s+=e+4}return i.slice(0,s)},u=e=>{const t=[],r=new TextDecoder;let n=0;for(;n<e.byteLength;){if(n+4>e.byteLength)return{err:new Error("Malformed buffer string encoding")};const i=new DataView(e,n).getUint32(0,!1);if(n+i+4>e.byteLength)return{err:new Error("Malformed buffer string encoding")};const s=r.decode(new Uint8Array(e,n+4,i));t.push(s),n+=i+4}return{value:t}},c=async e=>{const t=new TextEncoder,r=await crypto.subtle.digest("SHA-256",t.encode(e));return Array.from(new Uint8Array(r)).map((e=>e.toString(16).padStart(2,"0"))).join("")}},120:(e,t,r)=>{r.r(t),r.d(t,{default:()=>M});var n=r(424),i=r(724),s={type:"sync",importFFI:()=>r.e(423).then(r.bind(r,423)).then((e=>e.QuickJSFFI)),importModuleLoader:()=>r.e(971).then(r.bind(r,971)).then((e=>e.default))},o=r(37),a=r(957);function l(e){return e&&"default"in e&&e.default?e.default&&"default"in e.default&&e.default.default?e.default.default:e.default:e}r(465);var u=r(339),c=r(368),h=r(74),d=r(359),m=r(338),f=r(7),p=r(126),w=r(939),v=r(298);class g{#e;#t;#r;#n;#i;constructor(e,t){this.#e=e,this.#t=[],this.#r=0,this.#n=!1,this.#i=t}log(e,t){const r=`[${(new Date).toISOString()} ${e}] ${t}`;this.#t.length<this.#e?this.#t.push(r):(this.#t[this.#r]=r,this.#r=(this.#r+1)%this.#t.length,this.#n=!0),this.#i(this)}output(){return 0===this.#t.length?[]:this.#t.slice(this.#r).concat(this.#t.slice(0,this.#r))}isWrapped(){return this.#n}}class y{alive;#s;constructor(){this.alive=!0,this.#s=new Set}add(e){if(!this.alive)throw new Error("Lifetime manager is freed");return this.#s.add(e),e}remove(e){this.#s.delete(e)&&e.dispose()}dispose(){if(this.alive){for(const e of this.#s.values())e.dispose();this.#s.clear(),this.alive=!1}}}const S=(e,t,r)=>(e.newObject().consume((n=>{e.newFunction("log",((...t)=>{const n=t.map((t=>{const r=e.dump(t);if((0,m.gD)(r))return String(r);switch(typeof r){case"string":return r;case"number":case"bigint":case"boolean":case"symbol":return String(r);default:return JSON.stringify(r,void 0,"  ")}}));r.logger.log("qjs",n.join(" "))})).consume((t=>{e.setProp(n,"log",t)})),e.newFunction("sleep",(n=>{if("number"!==e.typeof(n))return{error:e.newError(new Error("Must provide sleep with a number of milliseconds"))};const i=e.getNumber(n),s=t.add(e.newPromise());return s.settled.then((()=>{e.runtime.alive&&e.runtime.executePendingJobs()})).catch((e=>{console.error("Unexpected QuickJS promise error",e)})),(0,m.yy)(i,{signal:r.signal}).then((()=>{e.alive&&s.resolve()})).catch((t=>{e.alive&&(t instanceof Error?e.newError(t).consume((e=>{s.reject(e)})):e.newError(JSON.stringify(t)).consume((e=>{s.reject(e)})))})).finally((()=>{t.remove(s)})),{value:s.handle}})).consume((t=>{e.setProp(n,"sleep",t)})),e.newFunction("sha256hex",(r=>{if("string"!==e.typeof(r))return{error:e.newError(new Error("Cannot hash a non-string"))};const n=e.getString(r),i=t.add(e.newPromise());return i.settled.then((()=>{e.runtime.alive&&e.runtime.executePendingJobs()})).catch((e=>{console.error("Unexpected QuickJS promise error",e)})),(0,v.Lg)(n).then((t=>{e.alive&&e.newString(t).consume((e=>{i.resolve(e)}))})).catch((t=>{e.alive&&(t instanceof Error?e.newError(t).consume((e=>{i.reject(e)})):e.newError(JSON.stringify(t)).consume((e=>{i.reject(e)})))})).finally((()=>{i.dispose()})),{value:i.handle}})).consume((t=>{e.setProp(n,"sha256hex",t)})),e.setProp(e.global,"universe",n)})),"export default universe;");var x=r(26);const b=({share:e,run:t})=>(0,n.jsx)(u.az,{padded:u.Y7.TB,paddedSmall:!0,children:(0,n.jsxs)(u.so,{alignItems:u.TR.Center,gap:"16px",children:[(0,n.jsx)("hgroup",{children:(0,n.jsx)("h1",{className:d.ef.TitleSmall,children:"JS Playground"})}),(0,n.jsxs)(c.e2,{children:[(0,n.jsx)(c.$n,{type:"reset",children:"Reset"}),(0,n.jsx)(c.$n,{onClick:e,children:"Share"}),(0,n.jsx)(c.$n,{onClick:t,children:"Run"})]})]})}),_="MAIN",E="main.js",T=({id:e,rm:t})=>{const r=e===_,s=(0,i.useCallback)((()=>{t(e)}),[e,t]);return(0,n.jsxs)("div",{children:[(0,n.jsx)(h.D0,{children:(0,n.jsxs)(u.so,{alignItems:u.TR.Center,gap:"8px",children:[(0,n.jsx)(h.JU,{children:"Filename"}),(0,n.jsx)(h.pd,{name:`${e}:name`,value:r?E:void 0,readOnly:r}),!r&&(0,n.jsx)(c.$n,{onClick:s,paddedSmall:!0,"aria-label":"Remove",children:(0,n.jsx)(w.U,{})})]})}),(0,n.jsx)(h.D0,{children:(0,n.jsxs)(u.so,{dir:u.hM.Col,children:[(0,n.jsx)(h.JU,{children:"Data"}),(0,n.jsx)(h.TM,{name:`${e}:data`,resize:h.$g.Vertical,rows:16,monospace:!0,fullWidth:!0})]})})]})},P=({add:e})=>(0,n.jsx)(u.az,{padded:u.Y7.TB,paddedSmall:!0,children:(0,n.jsx)(c.e2,{children:(0,n.jsx)(c.$n,{onClick:e,children:"Add"})})}),C=e=>"string"==typeof e?e:"",A=()=>{const e=crypto.randomUUID();return{files:[e],[`${_}:data`]:"import u from 'universe:std';\nimport * as secret from './secret.js';\n\nu.log('Hello, world');\n\nconst main = () => {\n  return secret.keyhash;\n};\nexport default main;\n",[`${e}:name`]:"secret.js",[`${e}:data`]:"import u from 'universe:std';\n\nconst key = 'top secret';\nu.log(key);\nexport const keyhash = await u.sha256hex(key);\n"}},k=()=>({stdout:"",stderr:"",stats:""}),M=()=>{const e=(0,h.mN)(A),t=e.state,c=e.setState,w=(0,i.useCallback)((()=>{c((e=>{const t=Object.assign({},e);t.files=t.files.slice();const r=crypto.randomUUID();return t.files.push(r),Object.assign(t,{[`${r}:name`]:"",[`${r}:data`]:""}),t}))}),[c]),M=(0,i.useCallback)((e=>{c((t=>{if(e===_)return t;const r=Object.assign({},t),n=r.files.indexOf(e);return n>-1&&(r.files=r.files.toSpliced(n,1)),delete r[`${e}:name`],delete r[`${e}:data`],r}))}),[c]),L=(0,i.useRef)();(0,i.useEffect)((()=>{const e=new AbortController;return L.current=e.signal,()=>{e.abort()}}),[L]);const j=(0,f.lq)().navigate,J=(0,i.useRef)(),H=(0,i.useRef)(""),Q=(0,i.useCallback)((()=>{(0,m.jq)(J.current)&&(J.current.abort(),J.current=void 0);const e=L.current;if((0,m.gD)(e))return;const r=new AbortController;J.current=r,e.addEventListener("abort",(()=>{r.abort()}),{signal:r.signal}),(async()=>{const e=await(0,v.Bc)((e=>{const t=[C(e[`${_}:data`])].concat(e.files.flatMap((t=>[C(e[`${t}:name`]),C(e[`${t}:data`])])));return(0,v.Hk)(t)})(t));if((0,m.KA)(e))return void console.error("Failed compressing url code",e.err);if((0,m.oH)(r.signal))return;const n=await(0,v.Lg)(e.value);if((0,m.oH)(r.signal))return;if(n===H.current)return;const i=new URLSearchParams({codev0:e.value});H.current=n,j(`#${i.toString()}`,!0)})()}),[J,L,t,H,j]),F=(0,i.useCallback)((()=>{j("",!0)}),[j]),R=(0,f.rd)().url;(0,i.useEffect)((()=>{let e=R.hash;if((0,m.gD)(e))return void(H.current="");e.startsWith("#")&&(e=e.slice(1));const t=new URLSearchParams(e).get("codev0");if((0,m.gD)(t)||""===t)return void(H.current="");const r=new AbortController;return(async()=>{const e=await(0,v.Lg)(t);if((0,m.oH)(r.signal))return;if(e===H.current)return;const n=await(0,v.mF)(t);if((0,m.oH)(r.signal))return;if(e===H.current)return;if(H.current=e,(0,m.KA)(n))return void console.error("Failed decompressing url code",n.err);const i=(e=>{const t=(0,v.bw)(e);if((0,m.KA)(t))return t;if(t.value.length<1)return{err:new Error("File state is malformed")};const r=[],n={files:r,[`${_}:data`]:t.value[0]},i=t.value.slice(1);if(i.length%2!=0)return{err:new Error("File state is malformed")};for(let e=1;e<i.length;e+=2){const t=i[e-1],s=i[e],o=crypto.randomUUID();r.push(o),n[`${o}:name`]=t??"",n[`${o}:data`]=s??""}return{value:n}})(n.value);(0,m.KA)(i)?console.error("Failed parsing url code",i.err):(console.log("setting files state"),c(i.value))})(),()=>{r.abort()}}),[H,R,c]);const[O,N]=(0,i.useState)();(0,i.useEffect)((()=>{const e=new AbortController;return(async()=>{const t=await(0,x.a)(fetch(o));if((0,m.oH)(e.signal))return;if((0,m.KA)(t))return void console.error("Failed compiling wasm module",t.err);const r=(n=s,i={wasmModule:t.value},{...n,async importModuleLoader(){let e=l(await n.importModuleLoader());return async function(){let t=i.emscriptenModule?{...i.emscriptenModule}:{},r=i.log??((...e)=>(0,a.a)("newVariant moduleLoader:",...e)),n=(e,t)=>(r(...e,t),t),s=e=>"function"==typeof e?e():e;(i.wasmLocation||i.wasmSourceMapLocation||i.locateFile)&&(t.locateFile=(e,t)=>{let r={fileName:e,relativeTo:t};if(e.endsWith(".wasm")&&void 0!==i.wasmLocation)return n(["locateFile .wasm: provide wasmLocation",r],i.wasmLocation);if(e.endsWith(".map")){if(void 0!==i.wasmSourceMapLocation)return n(["locateFile .map: provide wasmSourceMapLocation",r],i.wasmSourceMapLocation);if(i.wasmLocation&&!i.locateFile)return n(["locateFile .map: infer from wasmLocation",r],i.wasmLocation+".map")}return i.locateFile?n(["locateFile: use provided fn",r],i.locateFile(e,t)):n(["locateFile: unhandled, passthrough",r],e)}),i.wasmBinary&&(t.wasmBinary=await s(i.wasmBinary)),i.wasmMemory&&(t.wasmMemory=await s(i.wasmMemory));let o,l=i.wasmModule;l&&(t.instantiateWasm=async(e,t)=>{o??(o=Promise.resolve(s(l)));let r=await o;if(!r)throw new a.d(`options.wasmModule returned ${String(r)}`);let n=await WebAssembly.instantiate(r,e);return t(n),n.exports}),t.monitorRunDependencies=e=>{r("monitorRunDependencies:",e)},t.quickjsEmscriptenInit=()=>function(e){let t="mock called, emscripten module may not be initialized yet";return{mock:!0,removeRunDependency(r){e(`${t}: removeRunDependency called:`,r)},receiveSourceMapJSON(r){e(`${t}: receiveSourceMapJSON called:`,r)},WasmOffsetConverter:void 0,receiveWasmOffsetConverter(r,n){e(`${t}: receiveWasmOffsetConverter called:`,r,n)}}}(r);let u=e(t),c=t.quickjsEmscriptenInit?.(r);if(l&&c?.receiveWasmOffsetConverter&&!c.existingWasmOffsetConverter){let e=await s(i.wasmBinary)??new ArrayBuffer(0);o??(o=Promise.resolve(s(l)));let t=await o;if(!t)throw new a.d(`options.wasmModule returned ${String(t)}`);c.receiveWasmOffsetConverter(e,t)}if(c?.receiveSourceMapJSON){let e=await s(i.wasmSourceMapData);"string"==typeof e?c.receiveSourceMapJSON(JSON.parse(e)):e?c.receiveSourceMapJSON(e):c.receiveSourceMapJSON({version:3,names:[],sources:[],mappings:""})}return u}}});var n,i;N(r)})(),()=>{e.abort()}}),[N]);const B=(0,i.useRef)(),[I,V]=(0,i.useState)(k),$=(0,i.useCallback)((()=>{(0,m.jq)(B.current)&&(B.current.abort(),B.current=void 0);const e=L.current;if((0,m.gD)(e))return;if((0,m.gD)(O))return void(0,i.startTransition)((()=>{V(k)}));const n=new AbortController;B.current=n,e.addEventListener("abort",(()=>{n.abort()}),{signal:n.signal}),(0,i.startTransition)((()=>{V((e=>({stdout:e.stdout,stderr:"Loading...",stats:e.stats})))})),(async()=>{const e=new g(1024,(e=>{(0,m.oH)(n.signal)||(0,i.startTransition)((()=>{V({stdout:"",stderr:(e.isWrapped()?["...omitted..."]:[]).concat(e.output()).join("\n"),stats:""})}))})),s=(e=>{const t=new Map;return e.files.forEach((r=>{t.set(C(e[`${r}:name`]),C(e[`${r}:data`]))})),{files:t,main:C(e[`${_}:data`]),mainFileName:E}})(t),o=await(async(e,t,n)=>{const i=await async function(e){let t=l(await e),[n,i,{QuickJSWASMModule:s}]=await Promise.all([t.importModuleLoader().then(l),t.importFFI(),r.e(625).then(r.bind(r,625)).then(l)]),o=await n();return o.type="sync",new s(o,new i(o))}(e);if((0,m.oH)(n.signal))return{err:new Error("Signal aborted")};try{return await a.j.withScopeAsync((async e=>{const r=e.manage(i.newRuntime());r.setMemoryLimit(10485760),r.setMaxStackSize(1048576);const s=performance.now();let o=0;r.setInterruptHandler((()=>(o++,o>1024?(console.error("Interrupt cycles exceeded",{interruptCycles:o}),!0):performance.now()-s>2500?(console.error("Deadline exceeded",{interruptCycles:o}),!0):!!(0,m.oH)(n.signal)&&(console.error("Run cancelled",{interruptCycles:o}),!0))));const a=e.manage(r.newContext()),l=e.manage(new y);r.setModuleLoader(((e,r)=>{if("universe:std"===e)return{value:S(r,l,n)};const i=t.files.get(e);return(0,m.gD)(i)?{error:new Error(`No module ${e}`)}:{value:i}}));const u=e=>{if("error"in e)return void e.error.consume((e=>{n.logger.log("sys",`JS error: ${JSON.stringify(a.dump(e),void 0,"  ")}`)}));const t=e.value;if(!(0,m.oH)(n.signal))return t;t.dispose()},c=async e=>{const t=u(e);if(!(0,m.gD)(t))return await t.consume((async e=>await(async e=>{const t=a.resolvePromise(e);a.runtime.executePendingJobs();const r=await t;return u(r)})(e)))},h=await c(a.evalCode(t.main,t.mainFileName,{type:"module",strict:!0}));if((0,m.gD)(h))return{value:{value:void 0,duration:performance.now()-s,cycles:o}};const d=h.consume((e=>{if(n.logger.log("sys",`Main module exports: ${JSON.stringify(a.dump(e),void 0,"  ")}`),"object"===a.typeof(e))return a.getProp(e,"default")}));if((0,m.gD)(d))return{value:{value:void 0,duration:performance.now()-s,cycles:o}};const f=await d.consume((async e=>{if("function"!==a.typeof(e))return;const t=await c(a.callFunction(e,a.global));return(0,m.gD)(t)?void 0:t}));return(0,m.gD)(f)?{value:{value:void 0,duration:performance.now()-s,cycles:o}}:{value:{value:f.consume((e=>a.dump(e))),duration:performance.now()-s,cycles:o}}}))}catch(e){return{err:new Error("Failed executing QuickJS",{cause:e})}}})(O,s,{logger:e,signal:n.signal});(0,m.oH)(n.signal)||((0,m.KA)(o)?(0,i.startTransition)((()=>{V({stdout:"",stderr:(e.isWrapped()?["...omitted..."]:[]).concat(e.output()).concat(JSON.stringify(o.err,void 0,"  ")).join("\n"),stats:""})})):(0,i.startTransition)((()=>{V({stdout:(0,m.gD)(o.value.value)?"":JSON.stringify(o.value.value,void 0,"  "),stderr:(e.isWrapped()?["...omitted..."]:[]).concat(e.output()).join("\n"),stats:JSON.stringify({cycles:o.value.cycles,durationMS:o.value.duration})})})))})()}),[B,L,O,V,t]),D=(0,i.useDeferredValue)(I);return(0,n.jsx)(u.az,{padded:u.Y7.LR,center:!0,children:(0,n.jsxs)(h.lV,{form:e,onReset:F,children:[(0,n.jsx)(b,{share:Q,run:$}),(0,n.jsxs)(u.so,{gap:"16px",children:[(0,n.jsxs)(u.so,{dir:u.hM.Col,gap:"16px",className:p.A.files,children:[(0,n.jsx)(T,{id:_,rm:M}),t.files.map((e=>(0,n.jsx)(T,{id:e,rm:M},e))),(0,n.jsx)(P,{add:w})]}),(0,n.jsxs)(u.so,{dir:u.hM.Col,className:p.A.output,gap:"8px",children:[(0,n.jsx)("h2",{className:d.ef.TitleMedium,children:"Output"}),(0,n.jsx)("h3",{className:d.ef.TitleSmall,children:"Stats"}),(0,n.jsx)("pre",{children:D.stats}),(0,n.jsx)("h3",{className:d.ef.TitleSmall,children:"Main function return"}),(0,n.jsx)("pre",{children:D.stdout}),(0,n.jsx)("h3",{className:d.ef.TitleSmall,children:"Logs"}),(0,n.jsx)("pre",{children:D.stderr})]})]})]})})}},939:(e,t,r)=>{r.d(t,{U:()=>s});var n=r(424),i=r(126);const s=()=>(0,n.jsxs)("svg",{className:i.A["close-icon"],"aria-hidden":!0,width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"square",strokeLinejoin:"miter",fill:"none",children:[(0,n.jsx)("polyline",{points:"6 6 18 18"}),(0,n.jsx)("polyline",{points:"18 6 6 18"})]})},26:(e,t,r)=>{r.d(t,{O:()=>o,a:()=>s});var n=r(658),i=r(338);const s=async e=>{try{return{value:await WebAssembly.compileStreaming(e)}}catch(e){return{err:new Error("Failed compiling wasm module",{cause:e})}}},o=async(e,t)=>{const r=new TextEncoder,s=[],o=[],a=(0,i.gD)(t.stdin)?[]:r.encode(t.stdin),l=[new n.TG(new n.ZH(a)),n.Pn.lineBuffered((e=>{s.push(e)})),n.Pn.lineBuffered((e=>{o.push(e)}))],u=new n.bJ([],[],l);try{const t=await WebAssembly.instantiate(e,{wasi_snapshot_preview1:u.wasiImport});return t.exports.memory instanceof WebAssembly.Memory?"function"!=typeof t.exports._start?{err:new Error("Wasm module missing memory export")}:(u.start(t),{value:{stdout:s.join("\n"),stderr:o.join("\n")}}):{err:new Error("Wasm module missing memory export")}}catch(e){return{err:new Error("Failed running wasm module",{cause:e})}}}},37:(e,t,r)=>{e.exports=r.p+"static/wasm/emscripten-module.0799ffe4e57ed7e8.wasm"},465:(e,t,r)=>{r.d(t,{WB:()=>n,qG:()=>i,zd:()=>s});var n={JS_EVAL_TYPE_GLOBAL:0,JS_EVAL_TYPE_MODULE:1,JS_EVAL_TYPE_DIRECT:2,JS_EVAL_TYPE_INDIRECT:3,JS_EVAL_TYPE_MASK:3,JS_EVAL_FLAG_STRICT:8,JS_EVAL_FLAG_STRIP:16,JS_EVAL_FLAG_COMPILE_ONLY:32,JS_EVAL_FLAG_BACKTRACE_BARRIER:64},i={BaseObjects:1,Date:2,Eval:4,StringNormalize:8,RegExp:16,RegExpCompiler:32,JSON:64,Proxy:128,MapSet:256,TypedArrays:512,Promise:1024,BigInt:2048,BigFloat:4096,BigDecimal:8192,OperatorOverloading:16384,BignumExt:32768},s={Pending:0,Fulfilled:1,Rejected:2}},957:(e,t,r)=>{r.d(t,{a:()=>o,b:()=>c,d:()=>f,g:()=>E,j:()=>A,m:()=>L,n:()=>j,o:()=>Q,p:()=>F,q:()=>O,r:()=>N,s:()=>B,t:()=>I});var n=r(465),i=Object.defineProperty,s=!1;function o(...e){s&&console.log(...e)}((e,t)=>{for(var r in t)i(e,r,{get:t[r],enumerable:!0})})({},{QuickJSAsyncifyError:()=>h,QuickJSAsyncifySuspended:()=>d,QuickJSEmscriptenModuleError:()=>f,QuickJSMemoryLeakDetected:()=>m,QuickJSNotImplemented:()=>c,QuickJSPromisePending:()=>w,QuickJSUnknownIntrinsic:()=>p,QuickJSUnwrapError:()=>a,QuickJSUseAfterFree:()=>u,QuickJSWrongOwner:()=>l});var a=class extends Error{constructor(e,t){super(String(e)),this.cause=e,this.context=t,this.name="QuickJSUnwrapError"}},l=class extends Error{constructor(){super(...arguments),this.name="QuickJSWrongOwner"}},u=class extends Error{constructor(){super(...arguments),this.name="QuickJSUseAfterFree"}},c=class extends Error{constructor(){super(...arguments),this.name="QuickJSNotImplemented"}},h=class extends Error{constructor(){super(...arguments),this.name="QuickJSAsyncifyError"}},d=class extends Error{constructor(){super(...arguments),this.name="QuickJSAsyncifySuspended"}},m=class extends Error{constructor(){super(...arguments),this.name="QuickJSMemoryLeakDetected"}},f=class extends Error{constructor(){super(...arguments),this.name="QuickJSEmscriptenModuleError"}},p=class extends TypeError{constructor(){super(...arguments),this.name="QuickJSUnknownIntrinsic"}},w=class extends Error{constructor(){super(...arguments),this.name="QuickJSPromisePending"}};function*v(e){return yield e}var g=v;function y(e,t){return(...r)=>S(t.call(e,g,...r))}function S(e){return function t(r){return r.done?r.value:r.value instanceof Promise?r.value.then((r=>t(e.next(r))),(r=>t(e.throw(r)))):t(e.next(r.value))}(e.next())}g.of=function(e){return v(S(e))};var x=class{[Symbol.dispose](){return this.dispose()}},b=Symbol.dispose??Symbol.for("Symbol.dispose"),_=x.prototype;_[b]||(_[b]=function(){return this.dispose()});var E=class e extends x{constructor(e,t,r,n){super(),this._value=e,this.copier=t,this.disposer=r,this._owner=n,this._alive=!0,this._constructorStack=s?new Error("Lifetime constructed").stack:void 0}get alive(){return this._alive}get value(){return this.assertAlive(),this._value}get owner(){return this._owner}get dupable(){return!!this.copier}dup(){if(this.assertAlive(),!this.copier)throw new Error("Non-dupable lifetime");return new e(this.copier(this._value),this.copier,this.disposer,this._owner)}consume(e){this.assertAlive();let t=e(this);return this.dispose(),t}dispose(){this.assertAlive(),this.disposer&&this.disposer(this._value),this._alive=!1}assertAlive(){if(!this.alive)throw this._constructorStack?new u(`Lifetime not alive\n${this._constructorStack}\nLifetime used`):new u("Lifetime not alive")}},T=class extends E{constructor(e,t){super(e,void 0,void 0,t)}get dupable(){return!0}dup(){return this}dispose(){}},P=class extends E{constructor(e,t,r,n){super(e,t,r,n)}dispose(){this._alive=!1}};function C(e,t){let r;try{e.dispose()}catch(e){r=e}if(t&&r)throw Object.assign(t,{message:`${t.message}\n Then, failed to dispose scope: ${r.message}`,disposeError:r}),t;if(t||r)throw t||r}var A=class e extends x{constructor(){super(...arguments),this._disposables=new E(new Set)}static withScope(t){let r,n=new e;try{return t(n)}catch(e){throw r=e,e}finally{C(n,r)}}static withScopeMaybeAsync(t,r){return S(function*(n){let i,s=new e;try{return yield*n.of(r.call(t,n,s))}catch(e){throw i=e,e}finally{C(s,i)}}.call(void 0,g))}static async withScopeAsync(t){let r,n=new e;try{return await t(n)}catch(e){throw r=e,e}finally{C(n,r)}}manage(e){return this._disposables.value.add(e),e}get alive(){return this._disposables.alive}dispose(){let e=Array.from(this._disposables.value.values()).reverse();for(let t of e)t.alive&&t.dispose();this._disposables.dispose()}},k=class extends x{constructor(e){super(),this.resolve=e=>{this.resolveHandle.alive&&(this.context.unwrapResult(this.context.callFunction(this.resolveHandle,this.context.undefined,e||this.context.undefined)).dispose(),this.disposeResolvers(),this.onSettled())},this.reject=e=>{this.rejectHandle.alive&&(this.context.unwrapResult(this.context.callFunction(this.rejectHandle,this.context.undefined,e||this.context.undefined)).dispose(),this.disposeResolvers(),this.onSettled())},this.dispose=()=>{this.handle.alive&&this.handle.dispose(),this.disposeResolvers()},this.context=e.context,this.owner=e.context.runtime,this.handle=e.promiseHandle,this.settled=new Promise((e=>{this.onSettled=e})),this.resolveHandle=e.resolveHandle,this.rejectHandle=e.rejectHandle}get alive(){return this.handle.alive||this.resolveHandle.alive||this.rejectHandle.alive}disposeResolvers(){this.resolveHandle.alive&&this.resolveHandle.dispose(),this.rejectHandle.alive&&this.rejectHandle.dispose()}},M=class{constructor(e){this.module=e}toPointerArray(e){let t=new Int32Array(e.map((e=>e.value))),r=t.length*t.BYTES_PER_ELEMENT,n=this.module._malloc(r);return new Uint8Array(this.module.HEAPU8.buffer,n,r).set(new Uint8Array(t.buffer)),new E(n,void 0,(e=>this.module._free(e)))}newMutablePointerArray(e){let t=new Int32Array(new Array(e).fill(0)),r=t.length*t.BYTES_PER_ELEMENT,n=this.module._malloc(r),i=new Int32Array(this.module.HEAPU8.buffer,n,e);return i.set(t),new E({typedArray:i,ptr:n},void 0,(e=>this.module._free(e.ptr)))}newHeapCharPointer(e){let t=this.module.lengthBytesUTF8(e),r=t+1,n=this.module._malloc(r);return this.module.stringToUTF8(e,n,r),new E({ptr:n,strlen:t},void 0,(e=>this.module._free(e.ptr)))}newHeapBufferPointer(e){let t=e.byteLength,r=this.module._malloc(t);return this.module.HEAPU8.set(e,r),new E({pointer:r,numBytes:t},void 0,(e=>this.module._free(e.pointer)))}consumeHeapCharPointer(e){let t=this.module.UTF8ToString(e);return this.module._free(e),t}};function L(e){if(!e)return 0;let t=0;for(let[r,i]of Object.entries(e)){if(!(r in n.qG))throw new p(r);i&&(t|=n.qG[r])}return t}function j(e){if("number"==typeof e)return e;if(void 0===e)return 0;let{type:t,strict:r,strip:i,compileOnly:s,backtraceBarrier:o}=e,a=0;return"global"===t&&(a|=n.WB.JS_EVAL_TYPE_GLOBAL),"module"===t&&(a|=n.WB.JS_EVAL_TYPE_MODULE),r&&(a|=n.WB.JS_EVAL_FLAG_STRICT),i&&(a|=n.WB.JS_EVAL_FLAG_STRIP),s&&(a|=n.WB.JS_EVAL_FLAG_COMPILE_ONLY),o&&(a|=n.WB.JS_EVAL_FLAG_BACKTRACE_BARRIER),a}function J(...e){let t=[];for(let r of e)void 0!==r&&(t=t.concat(r));return t}Symbol("Unstable"),Object.freeze({BaseObjects:!0,Date:!0,Eval:!0,StringNormalize:!0,RegExp:!0,JSON:!0,Proxy:!0,MapSet:!0,TypedArrays:!0,Promise:!0});var H=class extends M{constructor(e){super(e.module),this.scope=new A,this.copyJSValue=e=>this.ffi.QTS_DupValuePointer(this.ctx.value,e),this.freeJSValue=e=>{this.ffi.QTS_FreeValuePointer(this.ctx.value,e)},e.ownedLifetimes?.forEach((e=>this.scope.manage(e))),this.owner=e.owner,this.module=e.module,this.ffi=e.ffi,this.rt=e.rt,this.ctx=this.scope.manage(e.ctx)}get alive(){return this.scope.alive}dispose(){return this.scope.dispose()}[Symbol.dispose](){return this.dispose()}manage(e){return this.scope.manage(e)}consumeJSCharPointer(e){let t=this.module.UTF8ToString(e);return this.ffi.QTS_FreeCString(this.ctx.value,e),t}heapValueHandle(e){return new E(e,this.copyJSValue,this.freeJSValue,this.owner)}},Q=class extends x{constructor(e){super(),this._undefined=void 0,this._null=void 0,this._false=void 0,this._true=void 0,this._global=void 0,this._BigInt=void 0,this.fnNextId=-32768,this.fnMaps=new Map,this.cToHostCallbacks={callFunction:(e,t,r,n,i)=>{if(e!==this.ctx.value)throw new Error("QuickJSContext instance received C -> JS call with mismatched ctx");let s=this.getFunction(i);if(!s)throw new Error(`QuickJSContext had no callback with id ${i}`);return A.withScopeMaybeAsync(this,(function*(e,i){let a=i.manage(new P(t,this.memory.copyJSValue,this.memory.freeJSValue,this.runtime)),l=new Array(r);for(let e=0;e<r;e++){let t=this.ffi.QTS_ArgvGetJSValueConstPointer(n,e);l[e]=i.manage(new P(t,this.memory.copyJSValue,this.memory.freeJSValue,this.runtime))}try{let t=yield*e(s.apply(a,l));if(t){if("error"in t&&t.error)throw o("throw error",t.error),t.error;let e=i.manage(t instanceof E?t:t.value);return this.ffi.QTS_DupValuePointer(this.ctx.value,e.value)}return 0}catch(e){return this.errorToHandle(e).consume((e=>this.ffi.QTS_Throw(this.ctx.value,e.value)))}}))}},this.runtime=e.runtime,this.module=e.module,this.ffi=e.ffi,this.rt=e.rt,this.ctx=e.ctx,this.memory=new H({...e,owner:this.runtime}),e.callbacks.setContextCallbacks(this.ctx.value,this.cToHostCallbacks),this.dump=this.dump.bind(this),this.getString=this.getString.bind(this),this.getNumber=this.getNumber.bind(this),this.resolvePromise=this.resolvePromise.bind(this)}get alive(){return this.memory.alive}dispose(){this.memory.dispose()}get undefined(){if(this._undefined)return this._undefined;let e=this.ffi.QTS_GetUndefined();return this._undefined=new T(e)}get null(){if(this._null)return this._null;let e=this.ffi.QTS_GetNull();return this._null=new T(e)}get true(){if(this._true)return this._true;let e=this.ffi.QTS_GetTrue();return this._true=new T(e)}get false(){if(this._false)return this._false;let e=this.ffi.QTS_GetFalse();return this._false=new T(e)}get global(){if(this._global)return this._global;let e=this.ffi.QTS_GetGlobalObject(this.ctx.value);return this.memory.manage(this.memory.heapValueHandle(e)),this._global=new T(e,this.runtime),this._global}newNumber(e){return this.memory.heapValueHandle(this.ffi.QTS_NewFloat64(this.ctx.value,e))}newString(e){let t=this.memory.newHeapCharPointer(e).consume((e=>this.ffi.QTS_NewString(this.ctx.value,e.value.ptr)));return this.memory.heapValueHandle(t)}newUniqueSymbol(e){let t=("symbol"==typeof e?e.description:e)??"",r=this.memory.newHeapCharPointer(t).consume((e=>this.ffi.QTS_NewSymbol(this.ctx.value,e.value.ptr,0)));return this.memory.heapValueHandle(r)}newSymbolFor(e){let t=("symbol"==typeof e?e.description:e)??"",r=this.memory.newHeapCharPointer(t).consume((e=>this.ffi.QTS_NewSymbol(this.ctx.value,e.value.ptr,1)));return this.memory.heapValueHandle(r)}newBigInt(e){if(!this._BigInt){let e=this.getProp(this.global,"BigInt");this.memory.manage(e),this._BigInt=new T(e.value,this.runtime)}let t=this._BigInt,r=String(e);return this.newString(r).consume((e=>this.unwrapResult(this.callFunction(t,this.undefined,e))))}newObject(e){e&&this.runtime.assertOwned(e);let t=e?this.ffi.QTS_NewObjectProto(this.ctx.value,e.value):this.ffi.QTS_NewObject(this.ctx.value);return this.memory.heapValueHandle(t)}newArray(){let e=this.ffi.QTS_NewArray(this.ctx.value);return this.memory.heapValueHandle(e)}newArrayBuffer(e){let t=new Uint8Array(e),r=this.memory.newHeapBufferPointer(t),n=this.ffi.QTS_NewArrayBuffer(this.ctx.value,r.value.pointer,t.length);return this.memory.heapValueHandle(n)}newPromise(e){let t=A.withScope((e=>{let t=e.manage(this.memory.newMutablePointerArray(2)),r=this.ffi.QTS_NewPromiseCapability(this.ctx.value,t.value.ptr),n=this.memory.heapValueHandle(r),[i,s]=Array.from(t.value.typedArray).map((e=>this.memory.heapValueHandle(e)));return new k({context:this,promiseHandle:n,resolveHandle:i,rejectHandle:s})}));return e&&"function"==typeof e&&(e=new Promise(e)),e&&Promise.resolve(e).then(t.resolve,(e=>e instanceof E?t.reject(e):this.newError(e).consume(t.reject))),t}newFunction(e,t){let r=++this.fnNextId;return this.setFunction(r,t),this.memory.heapValueHandle(this.ffi.QTS_NewFunction(this.ctx.value,r,e))}newError(e){let t=this.memory.heapValueHandle(this.ffi.QTS_NewError(this.ctx.value));return e&&"object"==typeof e?(void 0!==e.name&&this.newString(e.name).consume((e=>this.setProp(t,"name",e))),void 0!==e.message&&this.newString(e.message).consume((e=>this.setProp(t,"message",e)))):"string"==typeof e?this.newString(e).consume((e=>this.setProp(t,"message",e))):void 0!==e&&this.newString(String(e)).consume((e=>this.setProp(t,"message",e))),t}typeof(e){return this.runtime.assertOwned(e),this.memory.consumeHeapCharPointer(this.ffi.QTS_Typeof(this.ctx.value,e.value))}getNumber(e){return this.runtime.assertOwned(e),this.ffi.QTS_GetFloat64(this.ctx.value,e.value)}getString(e){return this.runtime.assertOwned(e),this.memory.consumeJSCharPointer(this.ffi.QTS_GetString(this.ctx.value,e.value))}getSymbol(e){this.runtime.assertOwned(e);let t=this.memory.consumeJSCharPointer(this.ffi.QTS_GetSymbolDescriptionOrKey(this.ctx.value,e.value));return this.ffi.QTS_IsGlobalSymbol(this.ctx.value,e.value)?Symbol.for(t):Symbol(t)}getBigInt(e){this.runtime.assertOwned(e);let t=this.getString(e);return BigInt(t)}getArrayBuffer(e){this.runtime.assertOwned(e);let t=this.ffi.QTS_GetArrayBufferLength(this.ctx.value,e.value),r=this.ffi.QTS_GetArrayBuffer(this.ctx.value,e.value);if(!r)throw new Error("Couldn't allocate memory to get ArrayBuffer");return new E(this.module.HEAPU8.subarray(r,r+t),void 0,(()=>this.module._free(r)))}getPromiseState(e){this.runtime.assertOwned(e);let t=this.ffi.QTS_PromiseState(this.ctx.value,e.value);if(t<0)return{type:"fulfilled",value:e,notAPromise:!0};if(t===n.zd.Pending)return{type:"pending",get error(){return new w("Cannot unwrap a pending promise")}};let r=this.ffi.QTS_PromiseResult(this.ctx.value,e.value),i=this.memory.heapValueHandle(r);if(t===n.zd.Fulfilled)return{type:"fulfilled",value:i};if(t===n.zd.Rejected)return{type:"rejected",error:i};throw i.dispose(),new Error(`Unknown JSPromiseStateEnum: ${t}`)}resolvePromise(e){this.runtime.assertOwned(e);let t=A.withScope((t=>{let r=t.manage(this.getProp(this.global,"Promise")),n=t.manage(this.getProp(r,"resolve"));return this.callFunction(n,r,e)}));return t.error?Promise.resolve(t):new Promise((e=>{A.withScope((r=>{let n=r.manage(this.newFunction("resolve",(t=>{e({value:t&&t.dup()})}))),i=r.manage(this.newFunction("reject",(t=>{e({error:t&&t.dup()})}))),s=r.manage(t.value),o=r.manage(this.getProp(s,"then"));this.unwrapResult(this.callFunction(o,s,n,i)).dispose()}))}))}getProp(e,t){this.runtime.assertOwned(e);let r=this.borrowPropertyKey(t).consume((t=>this.ffi.QTS_GetProp(this.ctx.value,e.value,t.value)));return this.memory.heapValueHandle(r)}setProp(e,t,r){this.runtime.assertOwned(e),this.borrowPropertyKey(t).consume((t=>this.ffi.QTS_SetProp(this.ctx.value,e.value,t.value,r.value)))}defineProp(e,t,r){this.runtime.assertOwned(e),A.withScope((n=>{let i=n.manage(this.borrowPropertyKey(t)),s=r.value||this.undefined,o=!!r.configurable,a=!!r.enumerable,l=!!r.value,u=r.get?n.manage(this.newFunction(r.get.name,r.get)):this.undefined,c=r.set?n.manage(this.newFunction(r.set.name,r.set)):this.undefined;this.ffi.QTS_DefineProp(this.ctx.value,e.value,i.value,s.value,u.value,c.value,o,a,l)}))}callFunction(e,t,...r){this.runtime.assertOwned(e);let n=this.memory.toPointerArray(r).consume((n=>this.ffi.QTS_Call(this.ctx.value,e.value,t.value,r.length,n.value))),i=this.ffi.QTS_ResolveException(this.ctx.value,n);return i?(this.ffi.QTS_FreeValuePointer(this.ctx.value,n),{error:this.memory.heapValueHandle(i)}):{value:this.memory.heapValueHandle(n)}}evalCode(e,t="eval.js",r){let n=void 0===r?1:0,i=j(r),s=this.memory.newHeapCharPointer(e).consume((e=>this.ffi.QTS_Eval(this.ctx.value,e.value.ptr,e.value.strlen,t,n,i))),o=this.ffi.QTS_ResolveException(this.ctx.value,s);return o?(this.ffi.QTS_FreeValuePointer(this.ctx.value,s),{error:this.memory.heapValueHandle(o)}):{value:this.memory.heapValueHandle(s)}}throw(e){return this.errorToHandle(e).consume((e=>this.ffi.QTS_Throw(this.ctx.value,e.value)))}borrowPropertyKey(e){return"number"==typeof e?this.newNumber(e):"string"==typeof e?this.newString(e):new T(e.value,this.runtime)}getMemory(e){if(e===this.rt.value)return this.memory;throw new Error("Private API. Cannot get memory from a different runtime")}dump(e){this.runtime.assertOwned(e);let t=this.typeof(e);if("string"===t)return this.getString(e);if("number"===t)return this.getNumber(e);if("bigint"===t)return this.getBigInt(e);if("undefined"===t)return;if("symbol"===t)return this.getSymbol(e);let r=this.getPromiseState(e);if("fulfilled"===r.type&&!r.notAPromise)return e.dispose(),{type:r.type,value:r.value.consume(this.dump)};if("pending"===r.type)return e.dispose(),{type:r.type};if("rejected"===r.type)return e.dispose(),{type:r.type,error:r.error.consume(this.dump)};let n=this.memory.consumeJSCharPointer(this.ffi.QTS_Dump(this.ctx.value,e.value));try{return JSON.parse(n)}catch{return n}}unwrapResult(e){if(e.error){let t="context"in e.error?e.error.context:this,r=e.error.consume((e=>this.dump(e)));if(r&&"object"==typeof r&&"string"==typeof r.message){let{message:e,name:n,stack:i}=r,s=new a(""),o=s.stack;throw"string"==typeof n&&(s.name=r.name),"string"==typeof i&&(s.stack=`${n}: ${e}\n${r.stack}Host: ${o}`),Object.assign(s,{cause:r,context:t,message:e}),s}throw new a(r,t)}return e.value}getFunction(e){let t=e>>8,r=this.fnMaps.get(t);if(r)return r.get(e)}setFunction(e,t){let r=e>>8,n=this.fnMaps.get(r);return n||(n=new Map,this.fnMaps.set(r,n)),n.set(e,t)}errorToHandle(e){return e instanceof E?e:this.newError(e)}encodeBinaryJSON(e){let t=this.ffi.QTS_bjson_encode(this.ctx.value,e.value);return this.memory.heapValueHandle(t)}decodeBinaryJSON(e){let t=this.ffi.QTS_bjson_decode(this.ctx.value,e.value);return this.memory.heapValueHandle(t)}},F=class extends x{constructor(e){super(),this.scope=new A,this.contextMap=new Map,this.cToHostCallbacks={shouldInterrupt:e=>{if(e!==this.rt.value)throw new Error("QuickJSContext instance received C -> JS interrupt with mismatched rt");let t=this.interruptHandler;if(!t)throw new Error("QuickJSContext had no interrupt handler");return t(this)?1:0},loadModuleSource:y(this,(function*(e,t,r,n){let i=this.moduleLoader;if(!i)throw new Error("Runtime has no module loader");if(t!==this.rt.value)throw new Error("Runtime pointer mismatch");let s=this.contextMap.get(r)??this.newContext({contextPointer:r});try{let t=yield*e(i(n,s));if("object"==typeof t&&"error"in t&&t.error)throw o("cToHostLoadModule: loader returned error",t.error),t.error;let r="string"==typeof t?t:"value"in t?t.value:t;return this.memory.newHeapCharPointer(r).value.ptr}catch(e){return o("cToHostLoadModule: caught error",e),s.throw(e),0}})),normalizeModule:y(this,(function*(e,t,r,n,i){let s=this.moduleNormalizer;if(!s)throw new Error("Runtime has no module normalizer");if(t!==this.rt.value)throw new Error("Runtime pointer mismatch");let a=this.contextMap.get(r)??this.newContext({contextPointer:r});try{let t=yield*e(s(n,i,a));if("object"==typeof t&&"error"in t&&t.error)throw o("cToHostNormalizeModule: normalizer returned error",t.error),t.error;let r="string"==typeof t?t:t.value;return a.getMemory(this.rt.value).newHeapCharPointer(r).value.ptr}catch(e){return o("normalizeModule: caught error",e),a.throw(e),0}}))},e.ownedLifetimes?.forEach((e=>this.scope.manage(e))),this.module=e.module,this.memory=new M(this.module),this.ffi=e.ffi,this.rt=e.rt,this.callbacks=e.callbacks,this.scope.manage(this.rt),this.callbacks.setRuntimeCallbacks(this.rt.value,this.cToHostCallbacks),this.executePendingJobs=this.executePendingJobs.bind(this)}get alive(){return this.scope.alive}dispose(){return this.scope.dispose()}newContext(e={}){let t=L(e.intrinsics),r=new E(e.contextPointer||this.ffi.QTS_NewContext(this.rt.value,t),void 0,(e=>{this.contextMap.delete(e),this.callbacks.deleteContext(e),this.ffi.QTS_FreeContext(e)})),n=new Q({module:this.module,ctx:r,ffi:this.ffi,rt:this.rt,ownedLifetimes:e.ownedLifetimes,runtime:this,callbacks:this.callbacks});return this.contextMap.set(r.value,n),n}setModuleLoader(e,t){this.moduleLoader=e,this.moduleNormalizer=t,this.ffi.QTS_RuntimeEnableModuleLoader(this.rt.value,this.moduleNormalizer?1:0)}removeModuleLoader(){this.moduleLoader=void 0,this.ffi.QTS_RuntimeDisableModuleLoader(this.rt.value)}hasPendingJob(){return!!this.ffi.QTS_IsJobPending(this.rt.value)}setInterruptHandler(e){let t=this.interruptHandler;this.interruptHandler=e,t||this.ffi.QTS_RuntimeEnableInterruptHandler(this.rt.value)}removeInterruptHandler(){this.interruptHandler&&(this.ffi.QTS_RuntimeDisableInterruptHandler(this.rt.value),this.interruptHandler=void 0)}executePendingJobs(e=-1){let t=this.memory.newMutablePointerArray(1),r=this.ffi.QTS_ExecutePendingJob(this.rt.value,e??-1,t.value.ptr),n=t.value.typedArray[0];if(t.dispose(),0===n)return this.ffi.QTS_FreeValuePointerRuntime(this.rt.value,r),{value:0};let i=this.contextMap.get(n)??this.newContext({contextPointer:n}),s=i.getMemory(this.rt.value).heapValueHandle(r);if("number"===i.typeof(s)){let e=i.getNumber(s);return s.dispose(),{value:e}}return{error:Object.assign(s,{context:i})}}setMemoryLimit(e){if(e<0&&-1!==e)throw new Error("Cannot set memory limit to negative number. To unset, pass -1");this.ffi.QTS_RuntimeSetMemoryLimit(this.rt.value,e)}computeMemoryUsage(){let e=this.getSystemContext().getMemory(this.rt.value);return e.heapValueHandle(this.ffi.QTS_RuntimeComputeMemoryUsage(this.rt.value,e.ctx.value))}dumpMemoryUsage(){return this.memory.consumeHeapCharPointer(this.ffi.QTS_RuntimeDumpMemoryUsage(this.rt.value))}setMaxStackSize(e){if(e<0)throw new Error("Cannot set memory limit to negative number. To unset, pass 0.");this.ffi.QTS_RuntimeSetMaxStackSize(this.rt.value,e)}assertOwned(e){if(e.owner&&e.owner.rt!==this.rt)throw new l(`Handle is not owned by this runtime: ${e.owner.rt.value} != ${this.rt.value}`)}getSystemContext(){return this.context||(this.context=this.scope.manage(this.newContext())),this.context}},R=class{constructor(e){this.callFunction=e.callFunction,this.shouldInterrupt=e.shouldInterrupt,this.loadModuleSource=e.loadModuleSource,this.normalizeModule=e.normalizeModule}},O=class{constructor(e){this.contextCallbacks=new Map,this.runtimeCallbacks=new Map,this.suspendedCount=0,this.cToHostCallbacks=new R({callFunction:(e,t,r,n,i,s)=>this.handleAsyncify(e,(()=>{try{let e=this.contextCallbacks.get(t);if(!e)throw new Error(`QuickJSContext(ctx = ${t}) not found for C function call "${s}"`);return e.callFunction(t,r,n,i,s)}catch(e){return console.error("[C to host error: returning null]",e),0}})),shouldInterrupt:(e,t)=>this.handleAsyncify(e,(()=>{try{let e=this.runtimeCallbacks.get(t);if(!e)throw new Error(`QuickJSRuntime(rt = ${t}) not found for C interrupt`);return e.shouldInterrupt(t)}catch(e){return console.error("[C to host interrupt: returning error]",e),1}})),loadModuleSource:(e,t,r,n)=>this.handleAsyncify(e,(()=>{try{let e=this.runtimeCallbacks.get(t);if(!e)throw new Error(`QuickJSRuntime(rt = ${t}) not found for C module loader`);let i=e.loadModuleSource;if(!i)throw new Error(`QuickJSRuntime(rt = ${t}) does not support module loading`);return i(t,r,n)}catch(e){return console.error("[C to host module loader error: returning null]",e),0}})),normalizeModule:(e,t,r,n,i)=>this.handleAsyncify(e,(()=>{try{let e=this.runtimeCallbacks.get(t);if(!e)throw new Error(`QuickJSRuntime(rt = ${t}) not found for C module loader`);let s=e.normalizeModule;if(!s)throw new Error(`QuickJSRuntime(rt = ${t}) does not support module loading`);return s(t,r,n,i)}catch(e){return console.error("[C to host module loader error: returning null]",e),0}}))}),this.module=e,this.module.callbacks=this.cToHostCallbacks}setRuntimeCallbacks(e,t){this.runtimeCallbacks.set(e,t)}deleteRuntime(e){this.runtimeCallbacks.delete(e)}setContextCallbacks(e,t){this.contextCallbacks.set(e,t)}deleteContext(e){this.contextCallbacks.delete(e)}handleAsyncify(e,t){if(e)return e.handleSleep((e=>{try{let r=t();if(!(r instanceof Promise))return o("asyncify.handleSleep: not suspending:",r),void e(r);if(this.suspended)throw new h(`Already suspended at: ${this.suspended.stack}\nAttempted to suspend at:`);this.suspended=new d(`(${this.suspendedCount++})`),o("asyncify.handleSleep: suspending:",this.suspended),r.then((t=>{this.suspended=void 0,o("asyncify.handleSleep: resolved:",t),e(t)}),(e=>{o("asyncify.handleSleep: rejected:",e),console.error("QuickJS: cannot handle error in suspended function",e),this.suspended=void 0}))}catch(e){throw o("asyncify.handleSleep: error:",e),this.suspended=void 0,e}}));let r=t();if(r instanceof Promise)throw new Error("Promise return value not supported in non-asyncify context.");return r}};function N(e,t){t.interruptHandler&&e.setInterruptHandler(t.interruptHandler),void 0!==t.maxStackSizeBytes&&e.setMaxStackSize(t.maxStackSizeBytes),void 0!==t.memoryLimitBytes&&e.setMemoryLimit(t.memoryLimitBytes)}function B(e,t){t.moduleLoader&&e.setModuleLoader(t.moduleLoader),t.shouldInterrupt&&e.setInterruptHandler(t.shouldInterrupt),void 0!==t.memoryLimitBytes&&e.setMemoryLimit(t.memoryLimitBytes),void 0!==t.maxStackSizeBytes&&e.setMaxStackSize(t.maxStackSizeBytes)}var I=class{constructor(e,t){this.module=e,this.ffi=t,this.callbacks=new O(e)}newRuntime(e={}){let t=new E(this.ffi.QTS_NewRuntime(),void 0,(e=>{this.callbacks.deleteRuntime(e),this.ffi.QTS_FreeRuntime(e)})),r=new F({module:this.module,callbacks:this.callbacks,ffi:this.ffi,rt:t});return N(r,e),e.moduleLoader&&r.setModuleLoader(e.moduleLoader),r}newContext(e={}){let t=this.newRuntime(),r=t.newContext({...e,ownedLifetimes:J(t,e.ownedLifetimes)});return t.context=r,r}evalCode(e,t={}){return A.withScope((r=>{let n=r.manage(this.newContext());B(n.runtime,t);let i=n.evalCode(e,"eval.js");if(void 0!==t.memoryLimitBytes&&n.runtime.setMemoryLimit(-1),i.error)throw n.dump(r.manage(i.error));return n.dump(r.manage(i.value))}))}getWasmMemory(){let e=this.module.quickjsEmscriptenInit?.((()=>{}))?.getWasmMemory?.();if(!e)throw new Error("Variant does not support getting WebAssembly.Memory");return e}getFFI(){return this.ffi}}},368:(e,t,r)=>{r.d(t,{$n:()=>l,e2:()=>u});var n=r(424),i=r(724),s=r(338);const o={button:"pkBVbp3Ygl_QZqv0","padded-small":"NZYOzjasZEy5sEGC",default:"CK5Yoodz1KncF_1H",subtle:"BIHZPzz3M45iRQOJ",primary:"yBO8SXTmTuf8luJR","button-group":"VYyNJIIwitjQDRnb",gap:"Q44AmYcqBs7R03Yt"};var a;!function(e){e.Default="default",e.Primary="primary",e.Subtle="subtle"}(a||(a={}));const l=(0,i.forwardRef)((({variant:e=a.Default,paddedSmall:t,className:r,children:i,...l},u)=>{const c=(0,s.xW)((0,s.Ty)(o,"button",e,{"padded-small":t}),r);return(0,n.jsx)("button",{ref:u,...l,className:c,children:i})})),u=(0,i.forwardRef)((({gap:e,className:t,children:r,...i},a)=>{const l=(0,s.xW)((0,s.Ty)(o,"button-group",{gap:e}),t);return(0,n.jsx)("div",{ref:a,...i,className:l,children:r})}))}}]);