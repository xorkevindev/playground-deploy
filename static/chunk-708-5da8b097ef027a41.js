(self.webpackChunk=self.webpackChunk||[]).push([[708],{708:(e,r,n)=>{n.r(r),n.d(r,{default:()=>R});var t=n(424),s=n(724),a=n(339),l=n(338);const i={button:"pkBVbp3Ygl_QZqv0","padded-small":"NZYOzjasZEy5sEGC",default:"CK5Yoodz1KncF_1H",subtle:"BIHZPzz3M45iRQOJ",primary:"yBO8SXTmTuf8luJR","button-group":"VYyNJIIwitjQDRnb",gap:"Q44AmYcqBs7R03Yt"};var o;!function(e){e.Default="default",e.Primary="primary",e.Subtle="subtle"}(o||(o={}));const c=(0,s.forwardRef)((({variant:e=o.Default,paddedSmall:r,className:n,children:s,...a},c)=>{const d=(0,l.xW)((0,l.Ty)(i,"button",e,{"padded-small":r}),n);return(0,t.jsx)("button",{ref:c,...a,className:d,children:s})})),d=(0,s.forwardRef)((({gap:e,className:r,children:n,...s},a)=>{const o=(0,l.xW)((0,l.Ty)(i,"button-group",{gap:e}),r);return(0,t.jsx)("div",{ref:a,...s,className:o,children:n})}));var u=n(74),f=n(359),h=n(7);const p=/\+|\/|=/g,m=/-|_/g,g=(e,r,n)=>{const t=new ArrayBuffer(Math.min(r,n));return new Uint8Array(t).set(new Uint8Array(e)),t},w=({share:e})=>(0,t.jsx)(a.az,{padded:a.Y7.TB,paddedSmall:!0,children:(0,t.jsxs)(a.so,{alignItems:a.TR.Center,gap:"16px",children:[(0,t.jsx)("hgroup",{children:(0,t.jsx)("h1",{className:f.ef.TitleSmall,children:"Jsonnet Playground"})}),(0,t.jsxs)(d,{children:[(0,t.jsx)(c,{type:"reset",children:"Reset"}),(0,t.jsx)(c,{onClick:e,children:"Share"})]})]})}),j="MAIN",x=()=>(0,t.jsxs)("svg",{className:"rLrbO7_RJ54qv6Tl","aria-hidden":!0,width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"square",strokeLinejoin:"miter",fill:"none",children:[(0,t.jsx)("polyline",{points:"6 6 18 18"}),(0,t.jsx)("polyline",{points:"18 6 6 18"})]}),b=({id:e,rm:r})=>{const n=e===j,l=(0,s.useCallback)((()=>{r(e)}),[e,r]);return(0,t.jsxs)("div",{children:[(0,t.jsx)(u.D0,{children:(0,t.jsxs)(a.so,{alignItems:a.TR.Center,gap:"8px",children:[(0,t.jsx)(u.JU,{children:"Filename"}),(0,t.jsx)(u.pd,{name:`${e}:name`,value:n?"main.jsonnet":void 0,readOnly:n}),!n&&(0,t.jsx)(c,{onClick:l,paddedSmall:!0,"aria-label":"Remove",children:(0,t.jsx)(x,{})})]})}),(0,t.jsx)(u.D0,{children:(0,t.jsxs)(a.so,{dir:a.hM.Col,children:[(0,t.jsx)(u.JU,{children:"Data"}),(0,t.jsx)(u.TM,{name:`${e}:data`,resize:u.$g.Vertical,rows:8,monospace:!0,fullWidth:!0})]})})]})},v=({add:e})=>(0,t.jsx)(a.az,{padded:a.Y7.TB,paddedSmall:!0,children:(0,t.jsx)(d,{children:(0,t.jsx)(c,{onClick:e,children:"Add"})})}),y=e=>"string"==typeof e?e:"",C=()=>({files:[],[`${j}:data`]:""}),R=()=>{const e=(0,u.mN)(C),r=e.state,n=e.setState;(0,s.useEffect)((()=>{n((e=>{let n;const t=new Set(r.files);for(const r of Object.keys(e)){if("files"===r)continue;const[s]=r.split(":",1);s===j||t.has(s)||(void 0===n&&(n=Object.assign({},e)),delete n[r])}return n??e}))}),[r,n]);const i=(0,s.useCallback)((()=>{n((e=>{const r=Object.assign({},e);r.files=r.files.slice();const n=crypto.randomUUID();return r.files.push(n),Object.assign(r,{[`${n}:name`]:"",[`${n}:data`]:""}),r}))}),[n]),o=(0,s.useCallback)((e=>{n((r=>{if(e===j)return r;const n=Object.assign({},r),t=n.files.indexOf(e);return t>-1&&(n.files=n.files.slice(),n.files.splice(t,1)),delete n[`${e}:name`],delete n[`${e}:data`],n}))}),[n]),c=(0,s.useRef)();(0,s.useEffect)((()=>{const e=new AbortController;return c.current=e.signal,()=>{e.abort()}}),[c]);const d=(0,h.lq)().navigate,f=(0,s.useCallback)((()=>{(async()=>{const e=await(async e=>{const r=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),n=await new Response(r).blob();return await new Promise((e=>{const r=new FileReader;r.onerror=()=>{e({err:r.error??new Error("File reader error")})},r.onload=()=>{if("string"!=typeof r.result)return void e({err:new Error("File reader result is not a string")});const n=r.result.indexOf(",");if(n<0)return void e({err:new Error("File reader result malformed")});const t=r.result.replaceAll(p,(e=>{switch(e){case"+":return"-";case"/":return"_";default:return""}})).slice(n+1);e({value:t})},r.readAsDataURL(n)}))})((n=r,(e=>{const r=e.reduce(((e,r)=>e+r.length),0),n=r+4*e.length,t=3*r+4*e.length;let s=new ArrayBuffer(n),a=0;const l=new TextEncoder;for(let r of e){let e=0;for(;;){const n=a+e+4+3*r.length;n>s.byteLength&&(s=g(s,n,t));const i=new Uint8Array(s,a+e+4),{read:o,written:c}=l.encodeInto(r,i);if(e+=c,o>=r.length)break;r=r.slice(o)}new DataView(s,a).setUint32(0,e,!1),a+=e+4}return s.slice(0,a)})([y(n[`${j}:data`])].concat(n.files.flatMap((e=>[y(n[`${e}:name`]),y(n[`${e}:data`])]))))));var n;if((0,l.KA)(e))return void console.error("Failed compressing url code",e.err);if(!0===c.current?.aborted)return;const t=new URLSearchParams({codev0:e.value});d(`#${t.toString()}`,!0)})()}),[r,c,d]),x=(0,h.rd)().url,R=(0,s.useRef)(!1);return(0,s.useEffect)((()=>{if(R.current)return;const e=new AbortController;let r=x.hash;if((0,l.gD)(r))return void(R.current=!0);r.startsWith("#")&&(r=r.slice(1));const t=new URLSearchParams(r).get("codev0");if(!(0,l.gD)(t)&&""!==t)return(async()=>{const r=await(async e=>{const r=e.replaceAll(m,(e=>{switch(e){case"-":return"+";case"_":return"/";default:return""}})),n=await fetch(`data:application/octet-stream;base64,${r}`),t=n.body?.pipeThrough(new DecompressionStream("gzip"))??new Blob([""]).stream();try{return{value:await new Response(t).arrayBuffer()}}catch(e){return{err:new Error("Failed decoding data",{cause:e})}}})(t);if((0,l.KA)(r))return console.error("Failed decompressing url code",r.err),void(R.current=!0);if(e.signal.aborted)return;const s=(e=>{const r=(e=>{const r=[],n=new TextDecoder;let t=0;for(;t<e.byteLength;){if(t+4>e.byteLength)return{err:new Error("Malformed buffer string encoding")};const s=new DataView(e,t).getUint32(0,!1);if(t+s+4>e.byteLength)return{err:new Error("Malformed buffer string encoding")};const a=n.decode(new Uint8Array(e,t+4,s));r.push(a),t+=s+4}return{value:r}})(e);if((0,l.KA)(r))return r;if(r.value.length%2!=1)return{err:new Error("File state is malformed")};const n=[],t={files:n,[`${j}:data`]:r.value[0]};for(let e=2;e<r.value.length;e+=2){const s=r.value[e-1],a=r.value[e],l=crypto.randomUUID();n.push(l),t[`${l}:name`]=s,t[`${l}:data`]=a}return{value:t}})(r.value);if((0,l.KA)(s))return console.error("Failed parsing url code",s.err),void(R.current=!0);R.current=!0,n(s.value)})(),()=>{e.abort()};R.current=!0}),[R,x,n]),(0,t.jsx)(a.az,{padded:a.Y7.LR,center:!0,children:(0,t.jsxs)(u.lV,{form:e,children:[(0,t.jsx)(w,{share:f}),(0,t.jsxs)(a.so,{gap:"16px",children:[(0,t.jsxs)(a.so,{dir:a.hM.Col,gap:"16px",className:"G_jALWivc15juUoy",children:[(0,t.jsx)(b,{id:j,rm:o}),r.files.map((e=>(0,t.jsx)(b,{id:e,rm:o},e))),(0,t.jsx)(v,{add:i})]}),(0,t.jsx)("div",{className:"Q9SofziWBuiCK64h",children:(0,t.jsx)("pre",{children:JSON.stringify(r,void 0,"  ")})})]})]})})}}}]);