(self.webpackChunk=self.webpackChunk||[]).push([[544],{126:(e,r,n)=>{n.d(r,{A:()=>t});const t={files:"UkIEeLqU2Pl7TsFd",output:"_sD7o_wV7TBzPe_2","close-icon":"n7k4OaLTM847piQx"}},298:(e,r,n)=>{n.d(r,{Bc:()=>s,Hk:()=>i,Lg:()=>d,bw:()=>c,mF:()=>o});const t=/\+|\/|=/g,s=async e=>{const r=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),n=await new Response(r).blob();return await new Promise((e=>{const r=new FileReader;r.onerror=()=>{e({err:r.error??new Error("File reader error")})},r.onload=()=>{if("string"!=typeof r.result)return void e({err:new Error("File reader result is not a string")});const n=r.result.indexOf(",");if(n<0)return void e({err:new Error("File reader result malformed")});const s=r.result.replaceAll(t,(e=>{switch(e){case"+":return"-";case"/":return"_";default:return""}})).slice(n+1);e({value:s})},r.readAsDataURL(n)}))},a=/-|_/g,o=async e=>{const r=e.replaceAll(a,(e=>{switch(e){case"-":return"+";case"_":return"/";default:return""}})),n=await fetch(`data:application/octet-stream;base64,${r}`),t=n.body?.pipeThrough(new DecompressionStream("gzip"))??new Blob([""]).stream();try{return{value:await new Response(t).arrayBuffer()}}catch(e){return{err:new Error("Failed decoding data",{cause:e})}}},l=(e,r,n)=>{const t=new ArrayBuffer(Math.min(r,n));return new Uint8Array(t).set(new Uint8Array(e)),t},i=e=>{const r=e.reduce(((e,r)=>e+r.length),0),n=r+4*e.length,t=3*r+4*e.length;let s=new ArrayBuffer(n),a=0;const o=new TextEncoder;for(let r of e){let e=0;for(;r.length>0;){const n=a+e+4+3*r.length;n>s.byteLength&&(s=l(s,n,t));const i=new Uint8Array(s,a+e+4),{read:c,written:d}=o.encodeInto(r,i);e+=d,r=r.slice(c)}new DataView(s,a).setUint32(0,e,!1),a+=e+4}return s.slice(0,a)},c=e=>{const r=[],n=new TextDecoder;let t=0;for(;t<e.byteLength;){if(t+4>e.byteLength)return{err:new Error("Malformed buffer string encoding")};const s=new DataView(e,t).getUint32(0,!1);if(t+s+4>e.byteLength)return{err:new Error("Malformed buffer string encoding")};const a=n.decode(new Uint8Array(e,t+4,s));r.push(a),t+=s+4}return{value:r}},d=async e=>{const r=new TextEncoder,n=await crypto.subtle.digest("SHA-256",r.encode(e));return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}},375:(e,r,n)=>{n.r(r),n.d(r,{default:()=>$});var t=n(424),s=n(724);const a=n.p+"static/wasm/jsonnet.engine.e07c8825c5927be8.wasm";var o=n(339),l=n(368),i=n(74),c=n(359),d=n(338),u=n(7),f=n(126),m=n(939),p=n(298),h=n(26);const g=({share:e})=>(0,t.jsx)(o.az,{padded:o.Y7.TB,paddedSmall:!0,children:(0,t.jsxs)(o.so,{alignItems:o.TR.Center,gap:"16px",children:[(0,t.jsx)("hgroup",{children:(0,t.jsx)("h1",{className:c.ef.TitleSmall,children:"Jsonnet Playground"})}),(0,t.jsxs)(l.e2,{children:[(0,t.jsx)(l.$n,{type:"reset",children:"Reset"}),(0,t.jsx)(l.$n,{onClick:e,children:"Share"})]}),(0,t.jsx)(i.D0,{children:(0,t.jsxs)(o.so,{alignItems:o.TR.Center,children:[(0,t.jsx)(i.pd,{type:"checkbox",name:"strout",toggleSwitch:!0}),(0,t.jsx)(i.JU,{children:"String Output"})]})})]})}),w="MAIN",b="main.jsonnet",x=({id:e,rm:r})=>{const n=e===w,a=(0,s.useCallback)((()=>{r(e)}),[e,r]);return(0,t.jsxs)("div",{children:[(0,t.jsx)(i.D0,{children:(0,t.jsxs)(o.so,{alignItems:o.TR.Center,gap:"8px",children:[(0,t.jsx)(i.JU,{children:"Filename"}),(0,t.jsx)(i.pd,{name:`${e}:name`,value:n?b:void 0,readOnly:n}),!n&&(0,t.jsx)(l.$n,{onClick:a,paddedSmall:!0,"aria-label":"Remove",children:(0,t.jsx)(m.U,{})})]})}),(0,t.jsx)(i.D0,{children:(0,t.jsxs)(o.so,{dir:o.hM.Col,children:[(0,t.jsx)(i.JU,{children:"Data"}),(0,t.jsx)(i.TM,{name:`${e}:data`,resize:i.$g.Vertical,rows:16,monospace:!0,fullWidth:!0})]})})]})},j=({add:e})=>(0,t.jsx)(o.az,{padded:o.Y7.TB,paddedSmall:!0,children:(0,t.jsx)(l.e2,{children:(0,t.jsx)(l.$n,{onClick:e,children:"Add"})})}),y=e=>"string"==typeof e?e:"",v=e=>{const r=[[b,y(e[`${w}:data`])]];return e.files.forEach((n=>r.push([y(e[`${n}:name`]),y(e[`${n}:data`])]))),{files:Object.fromEntries(r),strout:e.strout}},A=()=>{const e=crypto.randomUUID();return{files:[e],strout:!1,[`${w}:data`]:"local nstd = import 'native:std';\n\nlocal world = import 'dir/world.libsonnet';\n\nassert nstd.log(\n  'These functions are available in the additional native std lib',\n  std.map((function(i) i.key), std.objectKeysValuesAll(nstd)),\n);\n\nassert nstd.log('This is a secret', world.secret);\n\nlocal Person(name='World') = {\n  name: name,\n  welcome: 'Hello ' + name + '!',\n};\n\nlocal person = Person('Kevin');\n\n{\n  people: [Person(), person],\n  secret: world.secrethash,\n  obj: nstd.jsonMergePatch(\n    {\n      foo: {\n        bar: \"baz\",\n      },\n      hello: \"world\",\n    },\n    {\n      foo: {\n        bar: person.name,\n      },\n    },\n  ),\n}\n",[`${e}:name`]:"dir/world.libsonnet",[`${e}:data`]:"local nstd = import 'native:std';\n\n{\n  secret: 'top secret',\n  secrethash: nstd.sha256hex(self.secret),\n}\n"}},S=()=>({stdout:"",stderr:""}),$=()=>{const e=(0,i.mN)(A),r=e.state,n=e.setState;(0,s.useEffect)((()=>{n((e=>{let n;const t=new Set(r.files);for(const r of Object.keys(e)){if("files"===r||"strout"===r)continue;const[s]=r.split(":",1);s===w||t.has(s)||(void 0===n&&(n=Object.assign({},e)),delete n[r])}return n??e}))}),[r,n]);const l=(0,s.useCallback)((()=>{n((e=>{const r=Object.assign({},e);r.files=r.files.slice();const n=crypto.randomUUID();return r.files.push(n),Object.assign(r,{[`${n}:name`]:"",[`${n}:data`]:""}),r}))}),[n]),m=(0,s.useCallback)((e=>{n((r=>{if(e===w)return r;const n=Object.assign({},r),t=n.files.indexOf(e);return t>-1&&(n.files=n.files.toSpliced(t,1)),delete n[`${e}:name`],delete n[`${e}:data`],n}))}),[n]),b=(0,s.useRef)();(0,s.useEffect)((()=>{const e=new AbortController;return b.current=e.signal,()=>{e.abort()}}),[b]);const $=(0,s.useRef)(""),E=(0,s.useRef)(),C=(0,u.lq)().navigate,T=(0,s.useCallback)((()=>{(0,d.jq)(E.current)&&(E.current.abort(),E.current=void 0);const e=b.current;if((0,d.gD)(e))return;const n=new AbortController;E.current=n,e.addEventListener("abort",(()=>{n.abort()}),{signal:n.signal}),(async()=>{const e=await(0,p.Bc)((e=>{const r=[e.strout?"t":"f",y(e[`${w}:data`])].concat(e.files.flatMap((r=>[y(e[`${r}:name`]),y(e[`${r}:data`])])));return(0,p.Hk)(r)})(r));if((0,d.KA)(e))return void console.error("Failed compressing url code",e.err);if((0,d.oH)(n.signal))return;const t=await(0,p.Lg)(e.value);if((0,d.oH)(n.signal))return;if(t===$.current)return;const s=new URLSearchParams({codev0:e.value});$.current=t,C(`#${s.toString()}`,!0)})()}),[E,r,b,C]),k=(0,s.useCallback)((()=>{C("",!0)}),[C]),D=(0,u.rd)().url;(0,s.useEffect)((()=>{let e=D.hash;if((0,d.gD)(e))return void($.current="");e.startsWith("#")&&(e=e.slice(1));const r=new URLSearchParams(e).get("codev0");if((0,d.gD)(r)||""===r)return void($.current="");const t=new AbortController;return(async()=>{const e=await(0,p.Lg)(r);if((0,d.oH)(t.signal))return;if(e===$.current)return;const s=await(0,p.mF)(r);if((0,d.oH)(t.signal))return;if(e===$.current)return;if($.current=e,(0,d.KA)(s))return void console.error("Failed decompressing url code",s.err);const a=(e=>{const r=(0,p.bw)(e);if((0,d.KA)(r))return r;if(r.value.length<2)return{err:new Error("File state is malformed")};const n=[],t={files:n,strout:"t"===r.value[0],[`${w}:data`]:r.value[1]},s=r.value.slice(2);if(s.length%2!=0)return{err:new Error("File state is malformed")};for(let e=1;e<s.length;e+=2){const r=s[e-1],a=s[e],o=crypto.randomUUID();n.push(o),t[`${o}:name`]=r??"",t[`${o}:data`]=a??""}return{value:t}})(s.value);(0,d.KA)(a)?console.error("Failed parsing url code",a.err):(console.log("setting files state"),n(a.value))})(),()=>{t.abort()}}),[$,D,n]);const[U,R]=(0,s.useState)(void 0);(0,s.useEffect)((()=>{const e=new AbortController;return(async()=>{const r=await(0,h.a)(fetch(a));(0,d.oH)(e.signal)||((0,d.KA)(r)?console.error("Failed compiling wasm module",r.err):R(r.value))})(),()=>{e.abort()}}),[R]);const F=(0,s.useDeferredValue)(r),[L,O]=(0,s.useState)(S);(0,s.useEffect)((()=>{if((0,d.gD)(U))return void O(S);const e=new AbortController;return(async()=>{if(O((e=>({stdout:e.stdout,stderr:"Loading..."}))),await(0,d.yy)(250,{signal:e.signal}),(0,d.oH)(e.signal))return;const r=await(0,h.O)(U,{stdin:JSON.stringify(v(F))});(0,d.oH)(e.signal)||((0,d.KA)(r)?O({stdout:"",stderr:`Failed running wasm module: ${r.err.toString()}`}):O(r.value))})(),()=>{e.abort()}}),[O,U,F]);const B=(0,s.useDeferredValue)(L);return(0,t.jsx)(o.az,{padded:o.Y7.LR,center:!0,children:(0,t.jsxs)(i.lV,{form:e,onReset:k,children:[(0,t.jsx)(g,{share:T}),(0,t.jsxs)(o.so,{gap:"16px",children:[(0,t.jsxs)(o.so,{dir:o.hM.Col,gap:"16px",className:f.A.files,children:[(0,t.jsx)(x,{id:w,rm:m}),r.files.map((e=>(0,t.jsx)(x,{id:e,rm:m},e))),(0,t.jsx)(j,{add:l})]}),(0,t.jsxs)(o.so,{dir:o.hM.Col,className:f.A.output,gap:"8px",children:[(0,t.jsx)("h2",{className:c.ef.TitleMedium,children:"Output"}),(0,t.jsx)("pre",{children:B.stdout}),(0,t.jsx)("h3",{className:c.ef.TitleSmall,children:"Logs"}),(0,t.jsx)("pre",{children:B.stderr})]})]})]})})}},939:(e,r,n)=>{n.d(r,{U:()=>a});var t=n(424),s=n(126);const a=()=>(0,t.jsxs)("svg",{className:s.A["close-icon"],"aria-hidden":!0,width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"square",strokeLinejoin:"miter",fill:"none",children:[(0,t.jsx)("polyline",{points:"6 6 18 18"}),(0,t.jsx)("polyline",{points:"18 6 6 18"})]})},26:(e,r,n)=>{n.d(r,{O:()=>o,a:()=>a});var t=n(658),s=n(338);const a=async e=>{try{return{value:await WebAssembly.compileStreaming(e)}}catch(e){return{err:new Error("Failed compiling wasm module",{cause:e})}}},o=async(e,r)=>{const n=new TextEncoder,a=[],o=[],l=(0,s.gD)(r.stdin)?[]:n.encode(r.stdin),i=[new t.TG(new t.ZH(l)),t.Pn.lineBuffered((e=>{a.push(e)})),t.Pn.lineBuffered((e=>{o.push(e)}))],c=new t.bJ([],[],i);try{const r=await WebAssembly.instantiate(e,{wasi_snapshot_preview1:c.wasiImport});return r.exports.memory instanceof WebAssembly.Memory?"function"!=typeof r.exports._start?{err:new Error("Wasm module missing memory export")}:(c.start(r),{value:{stdout:a.join("\n"),stderr:o.join("\n")}}):{err:new Error("Wasm module missing memory export")}}catch(e){return{err:new Error("Failed running wasm module",{cause:e})}}}},368:(e,r,n)=>{n.d(r,{$n:()=>i,e2:()=>c});var t=n(424),s=n(724),a=n(338);const o={button:"pkBVbp3Ygl_QZqv0","padded-small":"NZYOzjasZEy5sEGC",default:"CK5Yoodz1KncF_1H",subtle:"BIHZPzz3M45iRQOJ",primary:"yBO8SXTmTuf8luJR","button-group":"VYyNJIIwitjQDRnb",gap:"Q44AmYcqBs7R03Yt"};var l;!function(e){e.Default="default",e.Primary="primary",e.Subtle="subtle"}(l||(l={}));const i=(0,s.forwardRef)((({variant:e=l.Default,paddedSmall:r,className:n,children:s,...i},c)=>{const d=(0,a.xW)((0,a.Ty)(o,"button",e,{"padded-small":r}),n);return(0,t.jsx)("button",{ref:c,...i,className:d,children:s})})),c=(0,s.forwardRef)((({gap:e,className:r,children:n,...s},l)=>{const i=(0,a.xW)((0,a.Ty)(o,"button-group",{gap:e}),r);return(0,t.jsx)("div",{ref:l,...s,className:i,children:n})}))}}]);