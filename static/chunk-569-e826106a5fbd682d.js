(self.webpackChunk=self.webpackChunk||[]).push([[569],{569:(e,r,s)=>{s.r(r),s.d(r,{default:()=>C});var t=s(424),n=s(724),a=s(339),l=s(338);const i={button:"pkBVbp3Ygl_QZqv0","padded-small":"NZYOzjasZEy5sEGC",default:"CK5Yoodz1KncF_1H",subtle:"BIHZPzz3M45iRQOJ",primary:"yBO8SXTmTuf8luJR","button-group":"VYyNJIIwitjQDRnb",gap:"Q44AmYcqBs7R03Yt"};var o;!function(e){e.Default="default",e.Primary="primary",e.Subtle="subtle"}(o||(o={}));const c=(0,n.forwardRef)((({variant:e=o.Default,paddedSmall:r,className:s,children:n,...a},c)=>{const d=(0,l.xW)((0,l.Ty)(i,"button",e,{"padded-small":r}),s);return(0,t.jsx)("button",{ref:c,...a,className:d,children:n})})),d=(0,n.forwardRef)((({gap:e,className:r,children:s,...n},a)=>{const o=(0,l.xW)((0,l.Ty)(i,"button-group",{gap:e}),r);return(0,t.jsx)("div",{ref:a,...n,className:o,children:s})}));var u=s(74),f=s(359),p=s(7);const h=/\+|\/|=/g,m=new TextEncoder,g=/-|_/g,j=({share:e})=>(0,t.jsx)(a.az,{padded:a.Y7.TB,paddedSmall:!0,children:(0,t.jsxs)(a.so,{alignItems:a.TR.Center,gap:"16px",children:[(0,t.jsx)("hgroup",{children:(0,t.jsx)("h1",{className:f.ef.TitleSmall,children:"Jsonnet Playground"})}),(0,t.jsxs)(d,{children:[(0,t.jsx)(c,{type:"reset",children:"Reset"}),(0,t.jsx)(c,{onClick:e,children:"Share"})]})]})}),x="MAIN",v=()=>(0,t.jsxs)("svg",{className:"rLrbO7_RJ54qv6Tl","aria-hidden":!0,width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"square",strokeLinejoin:"miter",fill:"none",children:[(0,t.jsx)("polyline",{points:"6 6 18 18"}),(0,t.jsx)("polyline",{points:"18 6 6 18"})]}),w=({id:e,rm:r})=>{const s=e===x,l=(0,n.useCallback)((()=>{r(e)}),[e,r]);return(0,t.jsxs)("div",{children:[(0,t.jsx)(u.D0,{children:(0,t.jsxs)(a.so,{alignItems:a.TR.Center,gap:"8px",children:[(0,t.jsx)(u.JU,{children:"Filename"}),(0,t.jsx)(u.pd,{name:`${e}:name`,value:s?"main.jsonnet":void 0,readOnly:s}),!s&&(0,t.jsx)(c,{onClick:l,paddedSmall:!0,"aria-label":"Remove",children:(0,t.jsx)(v,{})})]})}),(0,t.jsx)(u.D0,{children:(0,t.jsxs)(a.so,{dir:a.hM.Col,children:[(0,t.jsx)(u.JU,{children:"Data"}),(0,t.jsx)(u.TM,{name:`${e}:data`,resize:u.$g.Vertical,rows:8,monospace:!0,fullWidth:!0})]})})]})},b=({add:e})=>(0,t.jsx)(a.az,{padded:a.Y7.TB,paddedSmall:!0,children:(0,t.jsx)(d,{children:(0,t.jsx)(c,{onClick:e,children:"Add"})})}),y=()=>({files:[],[`${x}:data`]:""}),C=()=>{const e=(0,u.mN)(y),r=e.state,s=e.setState;(0,n.useEffect)((()=>{s((e=>{let s;const t=new Set(r.files);for(const r of Object.keys(e)){if("files"===r)continue;const[n]=r.split(":",1);n===x||t.has(n)||(void 0===s&&(s=Object.assign({},e)),delete s[r])}return s??e}))}),[r,s]);const i=(0,n.useCallback)((()=>{s((e=>{const r=Object.assign({},e);r.files=r.files.slice();const s=crypto.randomUUID();return r.files.push(s),Object.assign(r,{[`${s}:name`]:"",[`${s}:data`]:""}),r}))}),[s]),o=(0,n.useCallback)((e=>{s((r=>{if(e===x)return r;const s=Object.assign({},r),t=s.files.indexOf(e);return t>-1&&(s.files=s.files.slice(),s.files.splice(t,1)),delete s[`${e}:name`],delete s[`${e}:data`],s}))}),[s]),c=(0,n.useRef)();(0,n.useEffect)((()=>{const e=new AbortController;return c.current=e.signal,()=>{e.abort()}}),[c]);const d=(0,p.lq)().navigate,f=(0,n.useCallback)((()=>{(async()=>{const e=await(async e=>{const r=new Blob([m.encode(e)]).stream().pipeThrough(new CompressionStream("gzip")),s=await new Response(r).blob();return await new Promise((e=>{const r=new FileReader;r.onerror=()=>{e({err:r.error??new Error("File reader error")})},r.onload=()=>{if("string"!=typeof r.result)return void e({err:new Error("File reader result is not a string")});const s=r.result.indexOf(",");if(s<0)return void e({err:new Error("File reader result malformed")});const t=r.result.replaceAll(h,(e=>{switch(e){case"+":return"-";case"/":return"_";default:return""}})).slice(s+1);e({value:t})},r.readAsDataURL(s)}))})(JSON.stringify((e=>{const r=e[`${x}:data`]??"",s=["string"==typeof r?r:""];for(const r of e.files){const t=e[`${r}:name`]??"",n=e[`${r}:data`]??"";s.push("string"==typeof t?t:""),s.push("string"==typeof n?n:"")}return s})(r)));if((0,l.KA)(e))return void console.error("Failed compressing data",e.err);if(!0===c.current?.aborted)return;const s=new URLSearchParams({codev0:e.value});d(`#${s.toString()}`,!0)})()}),[r,c,d]),v=(0,p.rd)().url,C=(0,n.useRef)(!1);return(0,n.useEffect)((()=>{if(C.current)return;const e=new AbortController;let r=v.hash;if((0,l.gD)(r))return void(C.current=!0);r.startsWith("#")&&(r=r.slice(1));const t=new URLSearchParams(r).get("codev0");if(!(0,l.gD)(t)&&""!==t)return(async()=>{const r=await(async e=>{const r=e.replaceAll(g,(e=>{switch(e){case"-":return"+";case"_":return"/";default:return""}})),s=await fetch(`data:application/octet-stream;base64,${r}`),t=s.body?.pipeThrough(new DecompressionStream("gzip"))??new Blob(["[]"]).stream();try{return{value:await new Response(t).text()}}catch(e){return{err:new Error("Failed decoding data",{cause:e})}}})(t);if((0,l.KA)(r))return console.error("Failed decompressing data",r.err),void(C.current=!0);if(e.signal.aborted)return;const n=(e=>{const r=(e=>{try{const r=JSON.parse(e);if(!(0,l.cy)(r))return{err:new Error("File state is malformed")};const s=r;return s.every((e=>"string"==typeof e))?{value:s}:{err:new Error("File state is malformed")}}catch(e){return{err:new Error("Failed parsing file state from url",{cause:e})}}})(e);if((0,l.KA)(r))return r;if(r.value.length%2!=1)return{err:new Error("File state is malformed")};const s=[],t={files:s,[`${x}:data`]:r.value[0]};for(let e=2;e<r.value.length;e+=2){const n=r.value[e-1],a=r.value[e],l=crypto.randomUUID();s.push(l),t[`${l}:name`]=n,t[`${l}:data`]=a}return{value:t}})(r.value);if((0,l.KA)(n))return console.error("Failed parsing url code",n.err),void(C.current=!0);C.current=!0,s(n.value)})(),()=>{e.abort()};C.current=!0}),[C,v,s]),(0,t.jsx)(a.az,{padded:a.Y7.LR,center:!0,children:(0,t.jsxs)(u.lV,{form:e,children:[(0,t.jsx)(j,{share:f}),(0,t.jsxs)(a.so,{gap:"16px",children:[(0,t.jsxs)(a.so,{dir:a.hM.Col,gap:"16px",className:"G_jALWivc15juUoy",children:[(0,t.jsx)(w,{id:x,rm:o}),r.files.map((e=>(0,t.jsx)(w,{id:e,rm:o},e))),(0,t.jsx)(b,{add:i})]}),(0,t.jsx)("div",{className:"Q9SofziWBuiCK64h",children:(0,t.jsx)("pre",{children:JSON.stringify(r,void 0,"  ")})})]})]})})}}}]);